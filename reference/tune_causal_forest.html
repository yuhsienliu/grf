<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Causal forest tuning — tune_causal_forest • grf</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/all.min.css" integrity="sha256-nAmazAk6vS34Xqo0BSrTb+abbtFlgsFK7NKSi6o7Y78=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/v4-shims.min.css" integrity="sha256-6qHlizsOWFskGlwVOKuns+D1nB6ssZrHQrNj1wGplHc=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/headroom.min.js" integrity="sha256-DJFC1kqIhelURkuza0AvYal5RxMtpzLjFhsnVIeuk+U=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>



  
  <script src="../extra.js"></script>

<meta property="og:title" content="Causal forest tuning — tune_causal_forest" />
<meta property="og:description" content="Causal forest tuning" />
<meta name="twitter:card" content="summary" />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body>
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">grf</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.0.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../articles/grf.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Tutorials
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/categorical_inputs.html">Categorical inputs</a>
    </li>
    <li>
      <a href="../articles/ci_and_num.trees.html">Confidence intervals and the number of trees</a>
    </li>
    <li>
      <a href="../articles/diagnostics.html">Evaluating a causal forest fit</a>
    </li>
    <li>
      <a href="../articles/sample_weighting_examples.html">Sample weighting</a>
    </li>
  </ul>
</li>
<li>
  <a href="../REFERENCE.html">Algorithm reference</a>
</li>
<li>
  <a href="../DEVELOPING.html">Developing</a>
</li>
<li>
  <a href="../CHANGELOG.html">Changelog</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/grf-labs/grf">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Causal forest tuning</h1>
    <small class="dont-index">Source: <a href='https://github.com/grf-labs/grf/blob/master/R/tune_causal_forest.R'><code>R/tune_causal_forest.R</code></a></small>
    <div class="hidden name"><code>tune_causal_forest.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Causal forest tuning</p>
    </div>

    <pre class="usage"><span class='fu'>tune_causal_forest</span>(
  <span class='no'>X</span>,
  <span class='no'>Y</span>,
  <span class='no'>W</span>,
  <span class='no'>Y.hat</span>,
  <span class='no'>W.hat</span>,
  <span class='kw'>sample.weights</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='kw'>clusters</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='kw'>equalize.cluster.weights</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>,
  <span class='kw'>sample.fraction</span> <span class='kw'>=</span> <span class='fl'>0.5</span>,
  <span class='kw'>mtry</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/Extremes.html'>min</a></span>(<span class='fu'><a href='https://rdrr.io/r/base/Round.html'>ceiling</a></span>(<span class='fu'><a href='https://rdrr.io/r/base/MathFun.html'>sqrt</a></span>(<span class='fu'><a href='https://rdrr.io/r/base/nrow.html'>ncol</a></span>(<span class='no'>X</span>)) + <span class='fl'>20</span>), <span class='fu'><a href='https://rdrr.io/r/base/nrow.html'>ncol</a></span>(<span class='no'>X</span>)),
  <span class='kw'>min.node.size</span> <span class='kw'>=</span> <span class='fl'>5</span>,
  <span class='kw'>honesty</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>,
  <span class='kw'>honesty.fraction</span> <span class='kw'>=</span> <span class='fl'>0.5</span>,
  <span class='kw'>honesty.prune.leaves</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>,
  <span class='kw'>alpha</span> <span class='kw'>=</span> <span class='fl'>0.05</span>,
  <span class='kw'>imbalance.penalty</span> <span class='kw'>=</span> <span class='fl'>0</span>,
  <span class='kw'>stabilize.splits</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>,
  <span class='kw'>ci.group.size</span> <span class='kw'>=</span> <span class='fl'>2</span>,
  <span class='kw'>tune.parameters</span> <span class='kw'>=</span> <span class='st'>"all"</span>,
  <span class='kw'>tune.num.trees</span> <span class='kw'>=</span> <span class='fl'>200</span>,
  <span class='kw'>tune.num.reps</span> <span class='kw'>=</span> <span class='fl'>50</span>,
  <span class='kw'>tune.num.draws</span> <span class='kw'>=</span> <span class='fl'>1000</span>,
  <span class='kw'>num.threads</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='kw'>seed</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/stats/Uniform.html'>runif</a></span>(<span class='fl'>1</span>, <span class='fl'>0</span>, <span class='no'>.Machine</span>$<span class='no'>integer.max</span>)
)</pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>X</th>
      <td><p>The covariates used in the regression.</p></td>
    </tr>
    <tr>
      <th>Y</th>
      <td><p>The outcome.</p></td>
    </tr>
    <tr>
      <th>W</th>
      <td><p>The treatment assignment (may be binary or real).</p></td>
    </tr>
    <tr>
      <th>Y.hat</th>
      <td><p>Estimates of the expected responses E[Y | Xi], marginalizing
over treatment. See section 6.1.1 of the GRF paper for
further discussion of this quantity.</p></td>
    </tr>
    <tr>
      <th>W.hat</th>
      <td><p>Estimates of the treatment propensities E[W | Xi].</p></td>
    </tr>
    <tr>
      <th>sample.weights</th>
      <td><p>(experimental) Weights given to an observation in estimation.
If NULL, each observation is given the same weight. Default is NULL.</p></td>
    </tr>
    <tr>
      <th>clusters</th>
      <td><p>Vector of integers or factors specifying which cluster each observation corresponds to.
Default is NULL (ignored).</p></td>
    </tr>
    <tr>
      <th>equalize.cluster.weights</th>
      <td><p>If FALSE, each unit is given the same weight (so that bigger
clusters get more weight). If TRUE, each cluster is given equal weight in the forest. In this case,
during training, each tree uses the same number of observations from each drawn cluster: If the
smallest cluster has K units, then when we sample a cluster during training, we only give a random
K elements of the cluster to the tree-growing procedure. When estimating average treatment effects,
each observation is given weight 1/cluster size, so that the total weight of each cluster is the
same. Note that, if this argument is FALSE, sample weights may also be directly adjusted via the
sample.weights argument. If this argument is TRUE, sample.weights must be set to NULL. Default is
FALSE.</p></td>
    </tr>
    <tr>
      <th>sample.fraction</th>
      <td><p>Fraction of the data used to build each tree.
Note: If honesty = TRUE, these subsamples will
further be cut by a factor of honesty.fraction. Default is 0.5.</p></td>
    </tr>
    <tr>
      <th>mtry</th>
      <td><p>Number of variables tried for each split. Default is
\(\sqrt p + 20\) where p is the number of variables.</p></td>
    </tr>
    <tr>
      <th>min.node.size</th>
      <td><p>A target for the minimum number of observations in each tree leaf. Note that nodes
with size smaller than min.node.size can occur, as in the original randomForest package.
Default is 5.</p></td>
    </tr>
    <tr>
      <th>honesty</th>
      <td><p>Whether to use honest splitting (i.e., sub-sample splitting). Default is TRUE.
For a detailed description of honesty, honesty.fraction, honesty.prune.leaves, and recommendations for
parameter tuning, see the grf
<a href='https://grf-labs.github.io/grf/REFERENCE.html#honesty-honesty-fraction-honesty-prune-leaves'>algorithm reference</a>.</p></td>
    </tr>
    <tr>
      <th>honesty.fraction</th>
      <td><p>The fraction of data that will be used for determining splits if honesty = TRUE. Corresponds
to set J1 in the notation of the paper. Default is 0.5 (i.e. half of the data is used for
determining splits).</p></td>
    </tr>
    <tr>
      <th>honesty.prune.leaves</th>
      <td><p>If TRUE, prunes the estimation sample tree such that no leaves
are empty. If FALSE, keep the same tree as determined in the splits sample (if an empty leave is encountered, that
tree is skipped and does not contribute to the estimate). Setting this to FALSE may improve performance on
small/marginally powered data, but requires more trees (note: tuning does not adjust the number of trees).
Only applies if honesty is enabled. Default is TRUE.</p></td>
    </tr>
    <tr>
      <th>alpha</th>
      <td><p>A tuning parameter that controls the maximum imbalance of a split. Default is 0.05.</p></td>
    </tr>
    <tr>
      <th>imbalance.penalty</th>
      <td><p>A tuning parameter that controls how harshly imbalanced splits are penalized. Default is 0.</p></td>
    </tr>
    <tr>
      <th>stabilize.splits</th>
      <td><p>Whether or not the treatment should be taken into account when
determining the imbalance of a split. Default is TRUE.</p></td>
    </tr>
    <tr>
      <th>ci.group.size</th>
      <td><p>The forest will grow ci.group.size trees on each subsample.
In order to provide confidence intervals, ci.group.size must
be at least 2. Default is 2.</p></td>
    </tr>
    <tr>
      <th>tune.parameters</th>
      <td><p>A vector of parameter names to tune.
If "all": all tunable parameters are tuned by cross-validation. The following parameters are
tunable: ("sample.fraction", "mtry", "min.node.size", "honesty.fraction",
 "honesty.prune.leaves", "alpha", "imbalance.penalty"). If honesty is FALSE the honesty.* parameters are not tuned.
Default is "all".</p></td>
    </tr>
    <tr>
      <th>tune.num.trees</th>
      <td><p>The number of trees in each 'mini forest' used to fit the tuning model. Default is 50.</p></td>
    </tr>
    <tr>
      <th>tune.num.reps</th>
      <td><p>The number of forests used to fit the tuning model. Default is 100.</p></td>
    </tr>
    <tr>
      <th>tune.num.draws</th>
      <td><p>The number of random parameter values considered when using the model
to select the optimal parameters. Default is 1000.</p></td>
    </tr>
    <tr>
      <th>num.threads</th>
      <td><p>Number of threads used in training. By default, the number of threads is set
to the maximum hardware concurrency.</p></td>
    </tr>
    <tr>
      <th>seed</th>
      <td><p>The seed of the C++ random number generator.</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>A list consisting of the optimal parameter values ('params') along with their debiased
        error ('error').</p>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='kw'>if</span> (<span class='fl'>FALSE</span>) {
<span class='co'># Find the optimal tuning parameters.</span>
<span class='no'>n</span> <span class='kw'>&lt;-</span> <span class='fl'>500</span>
<span class='no'>p</span> <span class='kw'>&lt;-</span> <span class='fl'>10</span>
<span class='no'>X</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/matrix.html'>matrix</a></span>(<span class='fu'><a href='https://rdrr.io/r/stats/Normal.html'>rnorm</a></span>(<span class='no'>n</span> * <span class='no'>p</span>), <span class='no'>n</span>, <span class='no'>p</span>)
<span class='no'>W</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/Binomial.html'>rbinom</a></span>(<span class='no'>n</span>, <span class='fl'>1</span>, <span class='fl'>0.5</span>)
<span class='no'>Y</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/Extremes.html'>pmax</a></span>(<span class='no'>X</span>[, <span class='fl'>1</span>], <span class='fl'>0</span>) * <span class='no'>W</span> + <span class='no'>X</span>[, <span class='fl'>2</span>] + <span class='fu'><a href='https://rdrr.io/r/base/Extremes.html'>pmin</a></span>(<span class='no'>X</span>[, <span class='fl'>3</span>], <span class='fl'>0</span>) + <span class='fu'><a href='https://rdrr.io/r/stats/Normal.html'>rnorm</a></span>(<span class='no'>n</span>)
<span class='no'>Y.hat</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/predict.html'>predict</a></span>(<span class='fu'><a href='regression_forest.html'>regression_forest</a></span>(<span class='no'>X</span>, <span class='no'>Y</span>))$<span class='no'>predictions</span>
<span class='no'>W.hat</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/rep.html'>rep</a></span>(<span class='fl'>0.5</span>, <span class='no'>n</span>)
<span class='no'>params</span> <span class='kw'>&lt;-</span> <span class='fu'>tune_causal_forest</span>(<span class='no'>X</span>, <span class='no'>Y</span>, <span class='no'>W</span>, <span class='no'>Y.hat</span>, <span class='no'>W.hat</span>)$<span class='no'>params</span>

<span class='co'># Use these parameters to train a regression forest.</span>
<span class='no'>tuned.forest</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='causal_forest.html'>causal_forest</a></span>(<span class='no'>X</span>, <span class='no'>Y</span>, <span class='no'>W</span>,
  <span class='kw'>Y.hat</span> <span class='kw'>=</span> <span class='no'>Y.hat</span>, <span class='kw'>W.hat</span> <span class='kw'>=</span> <span class='no'>W.hat</span>, <span class='kw'>num.trees</span> <span class='kw'>=</span> <span class='fl'>1000</span>,
  <span class='kw'>min.node.size</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/numeric.html'>as.numeric</a></span>(<span class='no'>params</span>[<span class='st'>"min.node.size"</span>]),
  <span class='kw'>sample.fraction</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/numeric.html'>as.numeric</a></span>(<span class='no'>params</span>[<span class='st'>"sample.fraction"</span>]),
  <span class='kw'>mtry</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/numeric.html'>as.numeric</a></span>(<span class='no'>params</span>[<span class='st'>"mtry"</span>]),
  <span class='kw'>alpha</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/numeric.html'>as.numeric</a></span>(<span class='no'>params</span>[<span class='st'>"alpha"</span>]),
  <span class='kw'>imbalance.penalty</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/numeric.html'>as.numeric</a></span>(<span class='no'>params</span>[<span class='st'>"imbalance.penalty"</span>])
)
}</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
    <h2>Contents</h2>
    <ul class="nav nav-pills nav-stacked">
      <li><a href="#arguments">Arguments</a></li>
      <li><a href="#value">Value</a></li>
      <li><a href="#examples">Examples</a></li>
    </ul>

  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Julie Tibshirani, Susan Athey, Stefan Wager.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.4.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


