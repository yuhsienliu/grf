<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Developing • grf</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/all.min.css" integrity="sha256-nAmazAk6vS34Xqo0BSrTb+abbtFlgsFK7NKSi6o7Y78=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/v4-shims.min.css" integrity="sha256-6qHlizsOWFskGlwVOKuns+D1nB6ssZrHQrNj1wGplHc=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/headroom.min.js" integrity="sha256-DJFC1kqIhelURkuza0AvYal5RxMtpzLjFhsnVIeuk+U=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="pkgdown.css" rel="stylesheet">
<script src="pkgdown.js"></script>



  
  <script src="extra.js"></script>

<meta property="og:title" content="Developing" />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body>
    <div class="container template-title-body">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="index.html">grf</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.0.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="articles/grf.html">Get started</a>
</li>
<li>
  <a href="reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Tutorials
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="articles/categorical_inputs.html">Categorical inputs</a>
    </li>
    <li>
      <a href="articles/ci_and_num.trees.html">Confidence intervals and the number of trees</a>
    </li>
    <li>
      <a href="articles/diagnostics.html">Evaluating a causal forest fit</a>
    </li>
    <li>
      <a href="articles/sample_weighting_examples.html">Sample weighting</a>
    </li>
  </ul>
</li>
<li>
  <a href="REFERENCE.html">Algorithm reference</a>
</li>
<li>
  <a href="DEVELOPING.html">Developing</a>
</li>
<li>
  <a href="CHANGELOG.html">Changelog</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/grf-labs/grf">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="contents col-md-9">
    <div class="page-header">
      <h1>Developing</h1>
    </div>

<div id="developing" class="section level1">

<p>In addition to providing out-of-the-box forests for quantile regression and instrumental variables, grf provides a framework for creating forests tailored to new statistical tasks. Certain components around splitting and prediction can be swapped out, within the general infrastructure for growing and predicting on trees.</p>
<div id="contributing" class="section level2">
<h2 class="hasAnchor">
<a href="#contributing" class="anchor"></a>Contributing</h2>
<p>This repository follows the standard open source protocol and setup with git where there is an abundance of existing resources to get up to speed (see for example the contributing guidelines for well known packages in other languages, like Scikit-learn, Scipy, and pandas)</p>
<p>Condensed greatly, the workflow is to fork this repository, check out a branch, commit your changes (forming an ideally legible commit history), then submitting a pull request explaining your contribution, ideally referring to the issue you created, or the issue you chose to work on.</p>
</div>
<div id="working-with-the-code" class="section level2">
<h2 class="hasAnchor">
<a href="#working-with-the-code" class="anchor"></a>Working with the code</h2>
<p>The core forest implementation is written in C++, with an R interface powered by Rcpp. We recommend using a full-powered C++ IDE such as CLion, Xcode, or Visual Studio when working with the core code.</p>
</div>
<div id="r-package" class="section level2">
<h2 class="hasAnchor">
<a href="#r-package" class="anchor"></a>R package</h2>
<p>To build the R package from source, cd into <code>r-package</code> and run <code>build_package.R</code>. Required development dependencies are listed there. This mimics the tests run when submitting a pull request. Additional online package documentation is built on Travis with <a href="https://pkgdown.r-lib.org/">pkgdown</a>. Usage examples in the form of R Markdown files under <em>grf\vignettes</em> are built and rendered and the R method reference (along with the package articles) is displayed according to the layout defined in <em>pkgdown.yml</em>. To build the site locally run <code><a href="https://pkgdown.r-lib.org/reference/build_site.html">pkgdown::build_site()</a></code> from the R package directory.</p>
<p>An alternative development workflow is to use the accompanying grf.Rproj and build and test the package with RStudio’s build menu, which can be convenient for quickly iterating C++/R code changes.</p>
<div id="note-for-windows-users" class="section level3">
<h3 class="hasAnchor">
<a href="#note-for-windows-users" class="anchor"></a>Note for Windows users:</h3>
<p>Symlinks in the src directory point to the core C++ and R bindings. On Windows one has to clone this repository with symlinks enabled: <code>git clone -c core.symlinks=true https://github.com/grf-labs/grf.git</code> (this command needs to be run as an administrator: right click <em>Command Prompt -&gt; Run as administrator</em>). Caveat: the above RStudio workflow is not tested on Windows.</p>
</div>
</div>
<div id="core-c" class="section level2">
<h2 class="hasAnchor">
<a href="#core-c" class="anchor"></a>Core C++</h2>
<div id="code-structure" class="section level3">
<h3 class="hasAnchor">
<a href="#code-structure" class="anchor"></a>Code structure</h3>
<p><img src="https://raw.githubusercontent.com/grf-labs/grf/master/diagrams/arch_diagram.png" alt="GRF Architecture Diagram"></p>
<p>The forest implementation is composed of two top-level components, <a href="https://github.com/grf-labs/grf/blob/master/core/src/forest/ForestTrainer.h">ForestTrainer</a> and <a href="https://github.com/grf-labs/grf/blob/master/core/src/forest/ForestPredictor.h">ForestPredictor</a>.</p>
<p>ForestTrainer drives the tree-growing process, and has two pluggable components.</p>
<ul>
<li>
<a href="https://github.com/grf-labs/grf/blob/master/core/src/relabeling/RelabelingStrategy.h">RelabelingStrategy</a> is applied before every split, and produces a set of relabelled outcomes given the observations for a group of samples. In the case of quantile forests, for example, this strategy computes the quantiles for the group of samples, then relabels them with a factor corresponding to the quantile they belong to.</li>
<li>
<a href="https://github.com/grf-labs/grf/blob/master/core/src/splitting/SplittingRule.h">SplittingRule</a> is called to find the best split for a particular node, given a set of outcomes. There are currently implementations for standard regression and multinomial splitting.</li>
</ul>
<p>The trained forest produces a <a href="https://github.com/grf-labs/grf/blob/master/core/src/forest/Forest.h">Forest</a> object. This can then be passed to the ForestPredictor to predict on test samples. The predictor has a pluggable ‘prediction strategy’, which computes a prediction given a test sample. Prediction strategies can be one of two types:</p>
<ul>
<li>
<a href="https://github.com/grf-labs/grf/blob/master/core/src/prediction/DefaultPredictionStrategy.h">DefaultPredictionStrategy</a> computes a prediction given a weighted list of training sample IDs that share a leaf with the test sample. Taking quantile forests as an example, this strategy would compute the quantiles of the weighted leaf samples.</li>
<li>
<a href="https://github.com/grf-labs/grf/blob/master/core/src/prediction/OptimizedPredictionStrategy.h">OptimizedPredictionStrategy</a> does not predict using a list of neighboring samples and weights, but instead precomputes summary values for each leaf during training, and uses these during prediction. This type of strategy will also be passed to ForestTrainer, so it can define how the summary values are computed.</li>
</ul>
<p>Prediction strategies can also compute variance estimates for the predictions, given a forest trained with grouped trees. Because of performance constraints, only ‘optimized’ prediction strategies can provide variance estimates.</p>
<p>A particular type of forest is created by pulling together a set of pluggable components. As an example, a quantile forest is composed of a QuantileRelabelingStrategy, ProbabilitySplittingRule, and QuantilePredictionStrategy. The factory classes <a href="https://github.com/grf-labs/grf/blob/master/core/src/forest/ForestTrainers.h">ForestTrainers</a> and <a href="https://github.com/grf-labs/grf/blob/master/core/src/forest/ForestPredictors.h">ForestPredictors</a> define the common types of forests like regression, quantile, and causal forests.</p>
</div>
<div id="creating-a-custom-forest" class="section level3">
<h3 class="hasAnchor">
<a href="#creating-a-custom-forest" class="anchor"></a>Creating a custom forest</h3>
<p>When designing a forest for a new statistical task, we suggest following the format suggested in the paper: provide a custom RelabelingStrategy and PredictionStrategy, but use the standard RegressionSplittingRule. If modifications to the splitting rule must be made, they should be done carefully, as it is an extremely performance-sensitive piece of code.</p>
<p>To avoid the overhead of setting up new classes and Rcpp bindings, we provide a template for a ‘custom’ forest. To get started, fill in the implementation for CustomRelabelingStrategy and CustomPredictionStrategy. By default, the custom forest uses the standard regression splitting rule – if you’d like to change this, consult the ForestTrainers.custom_trainer method.</p>
<p>This forest is made available in R as <code>custom.forest</code> (with <code>predict.custom.forest</code>). You can find a starter template for a test exercising the forest in <code>testthat/test_custom_forest.R</code>. Note that you’ll need to re-run <code>build_package.R</code> after making changes to the C++ source.</p>
</div>
</div>
</div>

  </div>

</div>



      <footer>
      <div class="copyright">
  <p>Developed by Julie Tibshirani, Susan Athey, Stefan Wager.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.4.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


